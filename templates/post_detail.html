{% extends "base.html" %}
{% load static %}
{% block extra_css %}
<style>
.modal { display: none; position: fixed; z-index: 1000; left:0; top:0; width:100%; height:100%; background-color: rgba(0,0,0,0.6); }
.modal-content { background-color:#fff; margin:10% auto; padding:20px; width:400px; border-radius:8px; position:relative; }
.close { position:absolute; right:15px; top:10px; font-size:28px; color:#aaa; cursor:pointer; }
.cancelbtn { background-color:#ccc; color:black; padding:10px; width:48%; }
.deletebtn { background-color:#f44336; color:white; padding:10px; width:48%; }
.clearfix::after { content:""; clear:both; display:table; }
@media screen and (max-width:400px){ .cancelbtn, .deletebtn { width:100%; float:none; } }
</style>
{% endblock %}


{% block contents %}
<div class="container mt-4">

 
  <div class="card shadow-sm mb-4">
    {% if post.image %}
      <img src="{{ post.image.url }}" class="post_image" alt="{{ post.title }}">
    {% endif %}
    <div class="card-body">
      <h2 class="card-title">{{ post.title }}</h2>
      <p class="text-muted">By {{ post.author }} | {{ post.created_at|date:"F j, Y" }}</p>
      <p class="card-text">{{ post.content|linebreaks }}</p>
    </div>
  </div>


  {% if request.user == post.author %}
  <div class="mb-3 d-flex justify-content-start gap-2">
    <a href="{% url 'edit_post' id=post.id slug=post.slug %}" class="btn btn-primary">Edit Article</a>
   
  {% if user.is_author %}
  <button id="openModalBtn" class="btn btn-danger">Delete Post</button>
  {% endif %}


  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div class="modal-container">
        <h3>Confirm Delete</h3>
        <p>Are you sure you want to delete <strong>"{{ post.title }}"</strong>?</p>

        <div class="clearfix">
          <form method="POST" action="{% url 'delete_post' post.id post.slug %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="deletebtn">Yes</button>
          </form>
          <button class="cancelbtn" id="cancelBtn">No</button>
        </div>
      </div>
    </div>
  </div>

  </div>
  {% endif %}

 
  <div class="mb-4">
    {% if request.user.is_authenticated %}
      <form method="POST">
        {% csrf_token %}
        <button type="submit" name="like" class="btn btn-outline-primary">
          {% if request.user in post.likes.all %}
            ‚ù§Ô∏è Unlike ({{ likes_count }})
          {% else %}
            ‚ù§Ô∏è Like ({{ likes_count }})
          {% endif %}
        </button>
      </form>
    {% else %}
  
      <p>üëç: {{ likes_count }}</p>
    {% endif %}
  </div>


  <div class="card shadow-sm mb-4">
    <div class="card-header">
      <h5>Comments ({{ comments.count }})</h5>
    </div>
    <div class="card-body">
      {% if comments %}
        {% for comment in comments %}
          <div class="mb-3 border-bottom pb-2">
            <strong>{{ comment.user.username }}</strong>
            <span class="text-muted small">on {{ comment.created_at|date:"F j, Y H:i" }}</span>
            <p>{{ comment.content }}</p>

            {% if request.user.is_authenticated and comment.user == request.user %}
             
              <form method="POST" action="{% url 'delete_comment' comment.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
              </form>
            {% endif %}
          </div>
        {% endfor %}
      {% else %}
        <p class="text-muted">No comments yet. Be the first to comment!</p>
      {% endif %}
    </div>
  </div>

 
  {% if request.user.is_authenticated %}
    <div class="card shadow-sm mb-4">
      <div class="card-header">
        <h5>Leave a Comment</h5>
      </div>
      <div class="card-body">
        <form method="POST">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit" name="comment_submit" class="btn btn-primary">Post Comment</button>
        </form>
      </div>
    </div>
  {% else %}
    <p class="text-center text-danger fw-semibold">You must be logged in to like or comment on this post.</p>
  {% endif %}

</div>
{% endblock %}
{% block extra_js %}
<script>
const modal = document.getElementById("deleteModal");
const openBtn = document.getElementById("openModalBtn");
const closeBtn = modal.querySelector(".close");
const cancelBtn = document.getElementById("cancelBtn");


openBtn.onclick = () => { modal.style.display = "block"; }


closeBtn.onclick = () => { modal.style.display = "none"; }
cancelBtn.onclick = () => { modal.style.display = "none"; }


window.onclick = (event) => { if(event.target == modal) modal.style.display="none"; }
</script>
{% endblock %}


